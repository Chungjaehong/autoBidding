<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>사업의 첫걸음 - 링크업</title>
		<link href="./css/axis/AXJ.css" rel="stylesheet" />
		<link href="./css/axis/AXInput.css" rel="stylesheet" />
		<link href="./css/axis/AXButton.css" rel="stylesheet" />
    	<link href="./css/bootstrap.min.css" rel="stylesheet">
		<link href="./css/axis/AXJ.css" rel="stylesheet" />
		<link href="./css/axis/AXProgress.css" rel="stylesheet" />
    	<link href="./css/style.css" rel="stylesheet">

		<script>window.$ = window.jQuery = require('./js/jquery-3.1.0.js');</script>
		<script src="./js/axis/AXJ.js"></script>
		<script src="./js/bootstrap.min.js"></script>
		<script src="./js/axis/AXProgress.js"></script>
  </head>
  <style type="css/text">

  </style>
  <body style="back">
  <!--    <input type="button" id="btnTestAjax5" value="링크" class="AXButton Blue">
	  <input type="button" id="btnTestAjax" value="업데이트" class="AXButton Blue"> -->
	  
	  <div style="border: 1px dashed #BDBDBD; width: 540px; margin: 200px auto;">
		  </br>
         <div class="row">
            <div class="col-md-3" align="right">
                아이디 :
            </div>
            <div class="col-md-9">
                <input type="text" id="loginId" style="width: 250px;">
            </div>
		</div> 
        <div class="row">
            <div class="col-md-3" align="right">
                패스워드 : 
            </div>
            <div class="col-md-9">
                <input type="password" id="loginPw" name="loginPw"style="width: 250px;">
            </div>
		</div> 
        <div class="row">
            <div class="col-md-12" align="center">
                <input type="button" id="btnLogin" value="로그인" class="AXButton Blue">
            </div>
		</div>
        <div class="row">
            <div class="col-md-12" align="center">
                회원이 아니신가요 ? <a href="http://autobidding.rf.gd/bbs/register.php" target="_blank"> 회원가입 바로가기.</a> 
            </div>
		</div>

      </div>



  </body>

<script>
	originalFs = require('original-fs');
	got = require('got');

	var myProgress = new AXProgress();

	progStart = function(){
		mask.open();
		myProgress.start(function(){
			//trace(this);
			if(this.isEnd){
				//toast.push("progress end");

			}else{
				myProgress.update(); // 프로그레스의 다음 카운트를 시작합니다.
			}	
		}, 
		{
			totalCount:100,
			width:500, 
			top:200, 
			title:"업데이트 중..."
		});
	}

	varVersion = 1.0;

	updateVersionChk = function(){
		got('https://raw.githubusercontent.com/Chungjaehong/autoBidding/master/README.md')
		.then(response => {
			console.log("web Version>>"+response.body);
			console.log("app Version>>"+response.body);

			if(response.body > varVersion){
				progStart();
				
				got.stream('https://github.com/Chungjaehong/autoBidding/raw/master/resources/app.asar').pipe(
					originalFs.createWriteStream('resources/app.asar')
					.on('finish', () => {
						myProgress.close();
						mask.close();
						console.log("update Finish");
						location.replace("index.html");
						}
					)
				);

			}
		}).catch(error => {
			console.log(error.response.body);
		});

	}

	updateVersionChk();

	$("#btnLogin").click(function(){
		loginChk();
	});

	loginChk = function(){
		var id = $("#loginId").val();
		var pwd = $("#loginPw").val();

		sendData = {"mb_id" : id, "mb_pwd" : pwd };

		$.ajax({
			type: "POST",
			data : sendData,
			dataType: 'json',
			url : "http://localhost/autobidding/authCheck.php",
			async: false,
			success: function(data){
				if(data.flag =="S"){
					location.replace("main.html");
				}else{
					alert(data.message);
				}
			},
			error:function(XMLHttpRequest, textStatus, errorThrows){ // erreur durant la requete
      			alert("ERROR >>");
      		}
		});
	}

	$("input[name=loginPw]").keydown(function (key) {
 
        if(key.keyCode == 13){//키가 13이면 실행 (엔터는 13)
            loginChk();
        }
 
    });


</script>

<script>
	require('./renderer.js')
</script>


</html>
