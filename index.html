<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
		<link href="./css/axis/AXJ.css" rel="stylesheet" />
		<link href="./css/axis/AXProgress.css" rel="stylesheet" />
    	<link href="./css/style.css" rel="stylesheet">

		<script>window.$ = window.jQuery = require('./js/jquery-3.1.0.js');</script>
		<script src="./js/axis/AXJ.js"></script>
		<script src="./js/axis/AXProgress.js"></script>
  </head>
  <style type="css/text">

  </style>
  <body style="-webkit-app-region: drag">
      <input type="button" id="btnTestAjax5" value="링크" class="AXButton Blue">
	  <input type="button" id="btnTestAjax" value="업데이트" class="AXButton Blue">
  </body>

<script>
	const {app} = require('electron');
	originalFs = require('original-fs');
	got = require('got');

	var myProgress = new AXProgress();

	progStart = function(){
		mask.open();
		myProgress.start(function(){
			//trace(this);
			if(this.isEnd){
				//toast.push("progress end");

			}else{
				myProgress.update(); // 프로그레스의 다음 카운트를 시작합니다.
			}	
		}, 
		{
			totalCount:100,
			width:500, 
			top:200, 
			title:"업데이트 중..."
		});
	}

	varVersion = 1.0;

	updateVersionChk = function(){
		got('https://raw.githubusercontent.com/Chungjaehong/autoBidding/master/README.md')
		.then(response => {
			if(response.body > varVersion){
				progStart();
				
				got.stream('https://github.com/Chungjaehong/autoBidding/raw/master/resources/app.asar').pipe(
					originalFs.createWriteStream('resources/app.asar')
					.on('finish', () => {
						myProgress.close();
						mask.close();
						console.log("update Finish");
						location.replace("index.html");
						}
					)
				);

			}
		}).catch(error => {
			console.log(error.response.body);
		});

	}

	updateVersionChk();


	$("#btnTestAjax5").click(function(){
		location.replace("main.html");
	});

	$("#btnTestAjax").click(function(){
        
	});
</script>

<script>
	require('./renderer.js')
</script>


</html>
